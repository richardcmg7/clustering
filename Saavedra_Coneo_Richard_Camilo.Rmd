---
title: "Actividad_3_AA_G10"
author: "Richard Saavedra"
date: "6/22/2020"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# install.packages("corrplot")
#install.packages("gmodels")
#install.packages("tidyverse")
#install.packages("readr")
#install.packages("caret")
#install.packages('Hmisc')
#install.packages("modeest") 

# install.packages("e1071")
# install.packages("caTools")
# install.packages("http://download.r-forge.r-project.org/src/contrib/IsolationForest_0.0-26.tar.gz", repo=NULL, type="source")
# install.packages("h2o")
# install.packages("dygraphs")
# install.packages("dplyr")
# install.packages("DT")


```

```{r warning=FALSE, results='hide', message=FALSE}
library( h2o )
library(caTools)
library(e1071)
library(gmodels)
library(caret)
library(tidyverse)
library(Hmisc)
library(modeest)
library(cluster)
library(corrplot)
```

### Se cargan los datos a la variable `data`

```{r}
set.seed(1234)
data <- read_csv("data/datos.csv")


```

Se revisa si existen valores nulos.

```{r}
str(data)
```
### Se hallan de las variables númericas el valor mínimo máximo, la mediana y la media.

Se hallan de las variables categoricas las diferentes categorias y la frecuencia de cada una de ellas.

Eliminamos la columna Transaction date que contiene todos los valores nulos.

```{r}
data$`Transaction date` <- NULL

```

Volver las columnas categoricas a númericas

```{r}
data$isFradulent <- as.factor(data$isFradulent)
data$isForeignTransaction <- as.factor(data$isForeignTransaction)
data$isHighRiskCountry <- as.factor(data$isHighRiskCountry)
data$`Is declined` <- as.factor(data$`Is declined`)
```

```{r}
summary(data)

```


Se cambian los valores que estaban en caracter de Y y N reeemplazandolos por 1 y 0 respectivamente

```{r}
data$isFradulent <- ifelse(data$isFradulent == "N",0,1)
data$`Is declined` <- ifelse(data$`Is declined` == "N",0,1)
data$isHighRiskCountry <- ifelse(data$isHighRiskCountry == "N",0,1)
data$isForeignTransaction<- ifelse(data$isForeignTransaction == "N",0,1)

str(data)
summary(data)
```

### Se hallan la correlaciones existentes entre las variables del conjunto de datos mediante la matriz de correlación

```{r}
corr <- cor(data[,])
corrGreater <- findCorrelation(corr, cutoff=0.8)
corrGreater
```

Se grafica la Matriz de correlación

```{r results="hide"}

Mat_Correlacion <- cor(data, method = "pearson")
round(Mat_Correlacion, digits = 2)
corrplot(Mat_Correlacion)

```

Se definen el conjunto de datos de modelización y validación

```{r}
train_data <- sample(nrow(data), 0.8 * nrow(data))
data_train <- data[train_data, ]
data_test <- data[-train_data, ]

```

```{r error=FALSE, message=FALSE, results='hide'}
h2o.init()
```

```{r}

allData_hex = as.h2o( data_train )
str(allData_hex)
```
Se aplica la tecnica de detección de anomalias h2o.isolationforest
```{r}
dataModel = h2o.isolationForest( training_frame = allData_hex
                                     , sample_rate = 0.1
                                     , max_depth = 32
                                     , ntrees = 100
                                    )
```
Generamos la predicción
```{r}

```

```{r results='hide', warning=FALSE}
allData_hex_test = as.h2o( data_test)
```

```{r}
score = h2o.predict( dataModel, allData_hex_test )
result_pred = as.vector( score$predict )
result_pred
```

